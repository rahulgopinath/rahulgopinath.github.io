{"version":3,"file":"8516.a2096223c9b88679d090.js","mappings":"oTAmBO,MAAMA,EAAqB,IAAI,EAAAC,MAAM,6CAsBrC,MAAMC,UAAmB,EAAAC,eAI5BC,YAAYC,GACRC,MAAMC,OAAOC,OAAOD,OAAOC,OAAO,GAAIH,GAAU,CAAEI,QAAS,IAAI,EAAAC,OAAO,CAAEC,QAAS,CAAC,0BAClFC,KAAKC,gBAAiB,EACtBD,KAAKE,QAAU,IAAIC,UACnBH,KAAKI,SAAW,KAChBJ,KAAKK,WAAa,GAClBL,KAAKM,gBAAkB,IAAI,EAAAC,OAAOP,MAClCA,KAAKQ,WAAaf,EAAQe,YAAc,EAAAC,eACxC,MAAMC,EAAQV,KAAKQ,WAAWG,KAAK,cACnCX,KAAKH,QAAQe,SA3BH,iBA4BLZ,KAAKa,QAAQC,MAAMC,MAAK,KACzBf,KAAKgB,SAELhB,KAAKI,SAAW,IAAI,EAAAa,gBAAgB,CAChCC,OAAQlB,KAAKa,QAAQM,MAAMC,eAC3BC,QArCO,MAuCXrB,KAAKI,SAASkB,gBAAgBC,QAAQvB,KAAKgB,OAAQhB,SAGvDA,KAAKwB,QAAQC,QAAQ,UAAW,IAAI,EAAAC,cAAc,CAC9CC,KAAM,EAAAC,YACNC,QAASC,UACA9B,KAAKa,QAAQM,MAAMY,cACd/B,KAAKa,QAAQmB,SACnBhC,KAAKgB,WAGbiB,QAASvB,EAAMwB,GAAG,6BAGtBlC,KAAKwB,QAAQC,QAAQ,QAAS,EAAAU,YAAA,OAAmB,gBAAoBC,EAAQC,qBAAsB,CAAEC,aAActC,KAAMQ,WAAYR,KAAKQ,eAM9I,cACI,OAA0D,IAAnDR,KAAKH,QAAQE,QAAQwC,QAAQ,iBAExC,YAAYC,GACJxC,KAAKyC,UAAYD,IAIjBxC,KAAKH,QAAQE,QADbyC,EACuBJ,EAAQK,QAGRL,EAAQM,UAGnC1C,KAAKH,QAAQ8C,IAAM3C,KAAKH,QAAQ8C,IAChC3C,KAAKM,gBAAgBsC,KAAKJ,IAK9B,qBACI,OAAOxC,KAAKM,gBAKhBuC,UACI,GAAI7C,KAAKK,WACL,IACIyC,IAAIC,gBAAgB/C,KAAKK,YAE7B,MAAO2C,IAIXtD,MAAMmD,UAKVI,kBACQjD,KAAKC,iBAGTD,KAAKC,gBAAiB,EACjBD,KAAKkD,eAAenC,MAAK,IAAOf,KAAKC,gBAAiB,KAK/D,qBACI,IAAIkD,EAAOnD,KAAKa,QAAQM,MAAMiC,WAC9BD,QAAanD,KAAKqD,SAASF,GAE3B,MAAMG,EAAO,IAAIC,KAAK,CAACJ,GAAO,CAAEK,KAAM,cAChCC,EAASzD,KAAKK,WAIpB,GAHAL,KAAKK,WAAayC,IAAIY,gBAAgBJ,GACtCtD,KAAKH,QAAQ8C,IAAM3C,KAAKK,WAEpBoD,EACA,IACIX,IAAIC,gBAAgBU,GAExB,MAAOT,KAUf,eAAeG,GACX,MAAMQ,EAAM3D,KAAKE,QAAQ0D,gBAAgBT,EAAM,aAC/C,IAAIU,EAAOF,EAAIG,cAAc,QACxBD,IACDA,EAAOF,EAAII,cAAc,QACzBJ,EAAIK,KAAKC,aAAaJ,EAAMF,EAAIK,KAAKE,aAEzC,MAAMC,EAAOnE,KAAKa,QAAQsD,KACpBC,QAAgBpE,KAAKa,QAAQwD,YAAYC,eAAeH,GAO9D,OAFAN,EAAKU,KAAOH,EACZP,EAAKW,OAAS,QACPb,EAAIc,gBAAgBC,WAM5B,MAAMC,UAA0B,EAAAC,iBAInCC,gBAAgBhE,GACZ,OAAO,IAAIvB,EAAW,CAAEuB,QAAAA,KAMhC,IAAIuB,GACJ,SAAWA,GAIPA,EAAQM,UAAY,GAIpBN,EAAQK,QAAU,CAAC,iBAgBnBL,EAAQC,qBAVR,SAA8ByC,GAC1B,MACMpE,GADaoE,EAAMtE,YAAc,EAAAC,gBACdE,KAAK,cAC9B,OAAQ,gBAAoB,EAAAoE,UAAW,CAAE7D,OAAQ4D,EAAMxC,aAAa0C,eAAgBC,cAAeH,EAAMxC,eAAgB4C,GAAY,gBAAoB,EAAAC,uBAAwB,CAAEC,UAAW,GAAIvD,QAAS,IAAOiD,EAAMxC,aAAaG,SAAWqC,EAAMxC,aAAaG,QAAUR,QAASvB,EAAMwB,GAAG,4JAGnQmD,MAAOP,EAAMxC,aAAaG,QAC5C/B,EAAMwB,GAAG,iBACTxB,EAAMwB,GAAG,mBAtB3B,CAyBGE,IAAYA,EAAU","sources":["webpack://_JUPYTERLAB.CORE_OUTPUT/../../node_modules/@jupyterlab/htmlviewer/lib/index.js"],"sourcesContent":["/* -----------------------------------------------------------------------------\n| Copyright (c) Jupyter Development Team.\n| Distributed under the terms of the Modified BSD License.\n|----------------------------------------------------------------------------*/\n/**\n * @packageDocumentation\n * @module htmlviewer\n */\nimport { IFrame, ReactWidget, ToolbarButton, ToolbarButtonComponent, UseSignal } from '@jupyterlab/apputils';\nimport { ActivityMonitor } from '@jupyterlab/coreutils';\nimport { ABCWidgetFactory, DocumentWidget } from '@jupyterlab/docregistry';\nimport { nullTranslator } from '@jupyterlab/translation';\nimport { refreshIcon } from '@jupyterlab/ui-components';\nimport { Token } from '@lumino/coreutils';\nimport { Signal } from '@lumino/signaling';\nimport * as React from 'react';\n/**\n * The HTML viewer tracker token.\n */\nexport const IHTMLViewerTracker = new Token('@jupyterlab/htmlviewer:IHTMLViewerTracker');\n/**\n * The timeout to wait for change activity to have ceased before rendering.\n */\nconst RENDER_TIMEOUT = 1000;\n/**\n * The CSS class to add to the HTMLViewer Widget.\n */\nconst CSS_CLASS = 'jp-HTMLViewer';\n/**\n * A viewer widget for HTML documents.\n *\n * #### Notes\n * The iframed HTML document can pose a potential security risk,\n * since it can execute Javascript, and make same-origin requests\n * to the server, thereby executing arbitrary Javascript.\n *\n * Here, we sandbox the iframe so that it can't execute Javascript\n * or launch any popups. We allow one exception: 'allow-same-origin'\n * requests, so that local HTML documents can access CSS, images,\n * etc from the files system.\n */\nexport class HTMLViewer extends DocumentWidget {\n    /**\n     * Create a new widget for rendering HTML.\n     */\n    constructor(options) {\n        super(Object.assign(Object.assign({}, options), { content: new IFrame({ sandbox: ['allow-same-origin'] }) }));\n        this._renderPending = false;\n        this._parser = new DOMParser();\n        this._monitor = null;\n        this._objectUrl = '';\n        this._trustedChanged = new Signal(this);\n        this.translator = options.translator || nullTranslator;\n        const trans = this.translator.load('jupyterlab');\n        this.content.addClass(CSS_CLASS);\n        void this.context.ready.then(() => {\n            this.update();\n            // Throttle the rendering rate of the widget.\n            this._monitor = new ActivityMonitor({\n                signal: this.context.model.contentChanged,\n                timeout: RENDER_TIMEOUT\n            });\n            this._monitor.activityStopped.connect(this.update, this);\n        });\n        // Make a refresh button for the toolbar.\n        this.toolbar.addItem('refresh', new ToolbarButton({\n            icon: refreshIcon,\n            onClick: async () => {\n                if (!this.context.model.dirty) {\n                    await this.context.revert();\n                    this.update();\n                }\n            },\n            tooltip: trans.__('Rerender HTML Document')\n        }));\n        // Make a trust button for the toolbar.\n        this.toolbar.addItem('trust', ReactWidget.create(React.createElement(Private.TrustButtonComponent, { htmlDocument: this, translator: this.translator })));\n    }\n    /**\n     * Whether the HTML document is trusted. If trusted,\n     * it can execute Javascript in the iframe sandbox.\n     */\n    get trusted() {\n        return this.content.sandbox.indexOf('allow-scripts') !== -1;\n    }\n    set trusted(value) {\n        if (this.trusted === value) {\n            return;\n        }\n        if (value) {\n            this.content.sandbox = Private.trusted;\n        }\n        else {\n            this.content.sandbox = Private.untrusted;\n        }\n        // eslint-disable-next-line\n        this.content.url = this.content.url; // Force a refresh.\n        this._trustedChanged.emit(value);\n    }\n    /**\n     * Emitted when the trust state of the document changes.\n     */\n    get trustedChanged() {\n        return this._trustedChanged;\n    }\n    /**\n     * Dispose of resources held by the html viewer.\n     */\n    dispose() {\n        if (this._objectUrl) {\n            try {\n                URL.revokeObjectURL(this._objectUrl);\n            }\n            catch (error) {\n                /* no-op */\n            }\n        }\n        super.dispose();\n    }\n    /**\n     * Handle and update request.\n     */\n    onUpdateRequest() {\n        if (this._renderPending) {\n            return;\n        }\n        this._renderPending = true;\n        void this._renderModel().then(() => (this._renderPending = false));\n    }\n    /**\n     * Render HTML in IFrame into this widget's node.\n     */\n    async _renderModel() {\n        let data = this.context.model.toString();\n        data = await this._setBase(data);\n        // Set the new iframe url.\n        const blob = new Blob([data], { type: 'text/html' });\n        const oldUrl = this._objectUrl;\n        this._objectUrl = URL.createObjectURL(blob);\n        this.content.url = this._objectUrl;\n        // Release reference to any previous object url.\n        if (oldUrl) {\n            try {\n                URL.revokeObjectURL(oldUrl);\n            }\n            catch (error) {\n                /* no-op */\n            }\n        }\n        return;\n    }\n    /**\n     * Set a <base> element in the HTML string so that the iframe\n     * can correctly dereference relative links.\n     */\n    async _setBase(data) {\n        const doc = this._parser.parseFromString(data, 'text/html');\n        let base = doc.querySelector('base');\n        if (!base) {\n            base = doc.createElement('base');\n            doc.head.insertBefore(base, doc.head.firstChild);\n        }\n        const path = this.context.path;\n        const baseUrl = await this.context.urlResolver.getDownloadUrl(path);\n        // Set the base href, plus a fake name for the url of this\n        // document. The fake name doesn't really matter, as long\n        // as the document can dereference relative links to resources\n        // (e.g. CSS and scripts).\n        base.href = baseUrl;\n        base.target = '_self';\n        return doc.documentElement.innerHTML;\n    }\n}\n/**\n * A widget factory for HTMLViewers.\n */\nexport class HTMLViewerFactory extends ABCWidgetFactory {\n    /**\n     * Create a new widget given a context.\n     */\n    createNewWidget(context) {\n        return new HTMLViewer({ context });\n    }\n}\n/**\n * A namespace for private data.\n */\nvar Private;\n(function (Private) {\n    /**\n     * Sandbox exceptions for untrusted HTML.\n     */\n    Private.untrusted = [];\n    /**\n     * Sandbox exceptions for trusted HTML.\n     */\n    Private.trusted = ['allow-scripts'];\n    /**\n     * React component for a trusted button.\n     *\n     * This wraps the ToolbarButtonComponent and watches for trust changes.\n     */\n    function TrustButtonComponent(props) {\n        const translator = props.translator || nullTranslator;\n        const trans = translator.load('jupyterlab');\n        return (React.createElement(UseSignal, { signal: props.htmlDocument.trustedChanged, initialSender: props.htmlDocument }, session => (React.createElement(ToolbarButtonComponent, { className: \"\", onClick: () => (props.htmlDocument.trusted = !props.htmlDocument.trusted), tooltip: trans.__(`Whether the HTML file is trusted.\nTrusting the file allows scripts to run in it,\nwhich may result in security risks.\nOnly enable for files you trust.`), label: props.htmlDocument.trusted\n                ? trans.__('Distrust HTML')\n                : trans.__('Trust HTML') }))));\n    }\n    Private.TrustButtonComponent = TrustButtonComponent;\n})(Private || (Private = {}));\n//# sourceMappingURL=index.js.map"],"names":["IHTMLViewerTracker","Token","HTMLViewer","DocumentWidget","constructor","options","super","Object","assign","content","IFrame","sandbox","this","_renderPending","_parser","DOMParser","_monitor","_objectUrl","_trustedChanged","Signal","translator","nullTranslator","trans","load","addClass","context","ready","then","update","ActivityMonitor","signal","model","contentChanged","timeout","activityStopped","connect","toolbar","addItem","ToolbarButton","icon","refreshIcon","onClick","async","dirty","revert","tooltip","__","ReactWidget","Private","TrustButtonComponent","htmlDocument","indexOf","value","trusted","untrusted","url","emit","dispose","URL","revokeObjectURL","error","onUpdateRequest","_renderModel","data","toString","_setBase","blob","Blob","type","oldUrl","createObjectURL","doc","parseFromString","base","querySelector","createElement","head","insertBefore","firstChild","path","baseUrl","urlResolver","getDownloadUrl","href","target","documentElement","innerHTML","HTMLViewerFactory","ABCWidgetFactory","createNewWidget","props","UseSignal","trustedChanged","initialSender","session","ToolbarButtonComponent","className","label"],"sourceRoot":""}