"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[837],{60837:(t,e,n)=>{n.r(e),n.d(e,{default:()=>_});const a=new(n(93315).Token)("@jupyterlite/contents:IContents");var i=n(5768),o=n(75486),s=n.n(o);const r="JupyterLite Storage",c=new Set(["application/javascript","application/json","application/manifest+json","application/x-python-code","application/xml","image/svg+xml"]);class l{constructor(){this._serverContents=new Map,this._storage=s().createInstance({name:r,description:"Offline Storage for Notebooks and Files",storeName:"files",version:1}),this._counters=s().createInstance({name:r,description:"Store the current file suffix counters",storeName:"counters",version:1}),this._checkpoints=s().createInstance({name:r,description:"Offline Storage for Checkpoints",storeName:"checkpoints",version:1})}async newUntitled(t){var e,n,a;const o=null!==(e=null==t?void 0:t.path)&&void 0!==e?e:"",s=null!==(n=null==t?void 0:t.type)&&void 0!==n?n:"notebook",r=(new Date).toISOString();let c=i.PathExt.dirname(o);const l=i.PathExt.basename(o),m=i.PathExt.extname(o),d=await this.get(c);let h,f="";switch(o&&!m&&d?(c=`${o}/`,f=""):c&&l?(c=`${c}/`,f=l):(c="",f=o),s){case"directory":f=`Untitled Folder${await this._incrementCounter("directory")||""}`,h={name:f,path:`${c}${f}`,last_modified:r,created:r,format:"text",mimetype:"",content:null,size:void 0,writable:!0,type:"directory"};break;case"file":{const e=null!==(a=null==t?void 0:t.ext)&&void 0!==a?a:".txt",n=await this._incrementCounter("file");f=f||`untitled${n||""}${e}`,h={name:f,path:`${c}${f}`,last_modified:r,created:r,format:"text",mimetype:"text/plain",content:"",size:0,writable:!0,type:"file"};break}default:{const t=await this._incrementCounter("notebook");f=f||`Untitled${t||""}.ipynb`,h={name:f,path:`${c}${f}`,last_modified:r,created:r,format:"json",mimetype:"application/json",content:p.EMPTY_NB,size:JSON.stringify(p.EMPTY_NB).length,writable:!0,type:"notebook"};break}}const u=h.path;return await this._storage.setItem(u,h),h}async copy(t,e){let n=i.PathExt.basename(t);for(e=""===e?"":`${e.slice(1)}/`;await this.get(`${e}${n}`,{content:!0});){const t=i.PathExt.extname(n),e=n.replace(t,"");n=`${e} (copy)${t}`}const a=`${e}${n}`;let o=await this.get(t,{content:!0});if(!o)throw Error(`Could not find file with path ${t}`);return o={...o,name:n,path:a},await this._storage.setItem(a,o),o}async get(t,e){if(""===(t=decodeURIComponent(t.replace(/^\//,""))))return await this._getFolder(t);const n=await this._storage.getItem(t),a=await this._getServerContents(t,e),o=n||a;if(!o)return null;if(!(null==e?void 0:e.content))return{...o,content:null,size:void 0};if("directory"===o.type){const e=new Map;await this._storage.iterate(((n,a)=>{const i=n;a===`${t}/${i.name}`&&e.set(i.name,i)}));const n=a?a.content:Array.from((await this._getServerDirectory(t)).values());for(const t of n)e.has(t.name)||e.set(t.name,t);const s=[...e.values()];return{name:i.PathExt.basename(t),path:t,last_modified:o.last_modified,created:o.created,format:"json",mimetype:"application/json",content:s,size:void 0,writable:!0,type:"directory"}}return o}async rename(t,e){const n=decodeURIComponent(t),a=await this.get(n,{content:!0});if(!a)throw Error(`Could not find file with path ${n}`);const o=(new Date).toISOString(),s=i.PathExt.basename(e),r={...a,name:s,path:e,last_modified:o};if(await this._storage.setItem(e,r),await this._storage.removeItem(n),await this._checkpoints.removeItem(n),"directory"===a.type){let n;for(n of a.content)await this.rename(i.URLExt.join(t,n.name),i.URLExt.join(e,n.name))}return r}async save(t,e={}){var n;t=decodeURIComponent(t);let a=await this.get(t)||await this.newUntitled({path:t});if(!a)return null;const o=(new Date).toISOString();a={...a,...e,last_modified:o};const s=i.PathExt.extname(null!==(n=e.name)&&void 0!==n?n:"");if(e.content&&"base64"===e.format){const t=atob(e.content),n=".ipynb"===s;a={...a,content:n?JSON.parse(t):t,format:n?"json":"text",type:n?"notebook":"file"}}return await this._storage.setItem(t,a),a}async delete(t){t=decodeURIComponent(t);const e=[];await this._storage.iterate(((n,a)=>{(a===t||a.startsWith(`${t}/`))&&e.push(a)})),await Promise.all(e.map((async t=>Promise.all([this._storage.removeItem(t),this._checkpoints.removeItem(t)]))))}async createCheckpoint(t){var e;t=decodeURIComponent(t);const n=await this.get(t,{content:!0});if(!n)throw Error(`Could not find file with path ${t}`);const a=(null!==(e=await this._checkpoints.getItem(t))&&void 0!==e?e:[]).filter((t=>!!t));return a.push(n),a.length>5&&a.splice(0,a.length-5),await this._checkpoints.setItem(t,a),{id:""+(a.length-1),last_modified:n.last_modified}}async listCheckpoints(t){return(await this._checkpoints.getItem(t)||[]).filter((t=>!!t)).map(((t,e)=>({id:e.toString(),last_modified:t.last_modified})))}async restoreCheckpoint(t,e){t=decodeURIComponent(t);const n=(await this._checkpoints.getItem(t)||[])[parseInt(e)];await this._storage.setItem(t,n)}async deleteCheckpoint(t,e){t=decodeURIComponent(t);const n=await this._checkpoints.getItem(t)||[],a=parseInt(e);n.splice(a,1),await this._checkpoints.setItem(t,n)}async _getFolder(t){const e=new Map;await this._storage.iterate(((t,n)=>{if(n.includes("/"))return;const a=t;e.set(a.path,a)}));for(const n of(await this._getServerDirectory(t)).values())e.has(n.path)||e.set(n.path,n);return t&&0===e.size?null:{name:"",path:t,last_modified:new Date(0).toISOString(),created:new Date(0).toISOString(),format:"json",mimetype:"application/json",content:Array.from(e.values()),size:void 0,writable:!0,type:"directory"}}async _getServerContents(t,e){const n=i.PathExt.basename(t);let a=(await this._getServerDirectory(i.URLExt.join(t,".."))).get(n);if(!a)return null;if(a=a||{name:n,path:t,last_modified:new Date(0).toISOString(),created:new Date(0).toISOString(),format:"text",mimetype:"text/plain",type:"file",writable:!0,content:null},null==e?void 0:e.content)if("directory"===a.type){const e=await this._getServerDirectory(t);a={...a,content:Array.from(e.values())}}else{const e=i.URLExt.join(i.PageConfig.getBaseUrl(),"files",t),n=await fetch(e);if(!n.ok)return null;const o=a.mimetype||n.headers.get("Content-Type");a="notebook"===a.type||-1!==(null==o?void 0:o.indexOf("json"))||t.match(/\.(ipynb|[^/]*json[^/]*)$/)?{...a,content:await n.json(),format:"json",mimetype:a.mimetype||"application/json"}:-1!==o.indexOf("text")||c.has(o)?{...a,content:await n.text(),format:"text",mimetype:o||"text/plain"}:{...a,content:btoa(String.fromCharCode(...new Uint8Array(await n.arrayBuffer()))),format:"base64",mimetype:o||"octet/stream"}}return a}async _getServerDirectory(t){const e=this._serverContents.get(t)||new Map;if(!this._serverContents.has(t)){const n=i.URLExt.join(i.PageConfig.getBaseUrl(),"api/contents",t,"all.json");try{const t=await fetch(n),a=JSON.parse(await t.text());for(const t of a.content)e.set(t.name,t)}catch(t){console.warn(`don't worry, about ${t}... nothing's broken. if there had been a\n          file at ${n}, you might see some more files.`)}this._serverContents.set(t,e)}return e}async _incrementCounter(t){var e;const n=(null!==(e=await this._counters.getItem(t))&&void 0!==e?e:-1)+1;return await this._counters.setItem(t,n),n}}var p;!function(t){t.EMPTY_NB={metadata:{orig_nbformat:4},nbformat_minor:4,nbformat:4,cells:[]}}(p||(p={}));var m=n(63346),d=n(24076),h=n(16421),f=n(12169),u=n(81057);const w={id:"@jupyterlite/server-extension:contents",autoStart:!0,provides:a,activate:t=>new l},y={id:"@jupyterlite/server-extension:kernels",autoStart:!0,provides:m.IKernels,requires:[m.IKernelSpecs],activate:(t,e)=>new m.Kernels({kernelspecs:e})},v={id:"@jupyterlite/server-extension:kernelspec",autoStart:!0,provides:m.IKernelSpecs,activate:t=>new m.KernelSpecs({})},g={id:"@jupyterlite/server-extension:sessions",autoStart:!0,provides:h.ISessions,requires:[m.IKernels],activate:(t,e)=>new h.Sessions({kernels:e})},_=[w,y,v,{id:"@jupyterlite/server-extension:server",autoStart:!0,requires:[a,m.IKernels,m.IKernelSpecs,h.ISessions,f.ISettings,u.ITranslation],activate:(t,e,n,a,i,o,s)=>{const r=new d.JupyterServer({contents:e,kernels:n,kernelspecs:a,sessions:i,settings:o,translation:s}),c=new d.LiteServiceManager({server:r});t.registerServiceManager(c)}},g,{id:"@jupyterlite/server-extension:settings",autoStart:!0,provides:f.ISettings,activate:t=>new f.Settings},{id:"@jupyterlite/server-extension:translation",autoStart:!0,provides:u.ITranslation,activate:t=>new u.Translation}]}}]);
//# sourceMappingURL=837.3f3cc7efe581172c624f.js.map