---
layout: post
category : blog
tagline: "."
tags : [sunmicrosystems blog sun]
e: ACL, Parse thyself - Scripting with wadm (Part III)
---
{% raw %}
<div class="entry" id="acl_parse_thyself_scripting_with">

	<h3 class="entry-title">
			ACL, Parse thyself - Scripting with wadm (Part III)
	    </h3>

    <h4 class="entry-meta">By blue on <a href="#">Oct 16, 2006</a>
</h4>

    <div class="entry-body">
                                        	
The  Sun Java System Web Server contains a small language called ACL which defines the
Access rules for each resource. (Access Control Lists). While very
powerful, It is not very easy to manipulate the ACLS using the CLI in the raw form.<br><span style="color: rgb(204, 0, 0); font-weight: bold;"><br>Assume the wadm prompt is "|" so that </span><br style="color: rgb(204, 0, 0); font-weight: bold;"><span style="color: rgb(204, 0, 0); font-weight: bold;">|puts new</span><br style="color: rgb(204, 0, 0); font-weight: bold;"><span style="color: rgb(204, 0, 0); font-weight: bold;">is the wadm command "puts new"</span><br><br>The only support that we have from CLI are these commands:<br><span style="color: rgb(51, 51, 255);">|info commands \*acl\*</span><br><span style="font-style: italic;">set-acl list-acls delete-acl get-acl set-acl-cache-prop get-acl-cache-prop</span><br><br>Of which set-acl, list-acls, delete-acl, get-acl are the only commands that actualy work on ACL. As below.<br><br><span style="color: rgb(51, 51, 255);">|list-acls --config=test</span><br><span style="font-style: italic;">default</span><br style="font-style: italic;"><span style="font-style: italic;">es-internal</span><br style="font-style: italic;"><span style="font-style: italic;">mexico</span><br style="font-style: italic;">

<br><span style="color: rgb(51, 51, 255);"></span><span style="color: rgb(51, 51, 255);">|get-acl --config=test</span><br><span style="font-style: italic;"># File automatically written</span><br style="font-style: italic;"><span style="font-style: italic;"></span><span style="font-style: italic;">version 3.0;</span><br style="font-style: italic;"><br style="font-style: italic;"><span style="font-style: italic;">acl "default";</span><br style="font-style: italic;"><span style="font-style: italic;">authenticate (user,group) {</span><br style="font-style: italic;"><span style="font-style: italic;">        prompt = "Sun Java System Web Server";</span><br style="font-style: italic;"><span style="font-style: italic;">};</span><br style="font-style: italic;"><span style="font-style: italic;">allow (read,execute,info) </span><br style="font-style: italic;"><span style="font-style: italic;">    user = "anyone";</span><br style="font-style: italic;"><span style="font-style: italic;">allow (list,write,delete) </span><br style="font-style: italic;"><span style="font-style: italic;">    user = "all";</span><br style="font-style: italic;"><br style="font-style: italic;"><span style="font-style: italic;">acl "es-internal";</span><br style="font-style: italic;"><span style="font-style: italic;">allow (read,execute,info) </span><br style="font-style: italic;"><span style="font-style: italic;">    user = "anyone";</span><br style="font-style: italic;"><span style="font-style: italic;">deny (list,write,delete) </span><br style="font-style: italic;"><span style="font-style: italic;">    user = "anyone";</span><br style="font-style: italic;"><br style="font-style: italic;"><span style="font-style: italic;">acl "mexico";</span><br style="font-style: italic;"><span style="font-style: italic;">authenticate (user,group) {</span><br style="font-style: italic;"><span style="font-style: italic;">        database = "default";</span><br style="font-style: italic;"><span style="font-style: italic;">        method = "basic";</span><br style="font-style: italic;"><span style="font-style: italic;">        prompt = "Hi there..";</span><br style="font-style: italic;"><span style="font-style: italic;">};</span><br style="font-style: italic;"><span style="font-style: italic;">deny (all) </span><br style="font-style: italic;"><span style="font-style: italic;">    user = "anyone";</span><br style="font-style: italic;"><span style="font-style: italic;">allow (read,write,execute,delete,list,info) </span><br style="font-style: italic;"><span style="font-style: italic;">    user = "rahul" and</span><br style="font-style: italic;"><span style="font-style: italic;">    ip = "129.158.223.\*,129.158.224.\*" or</span><br style="font-style: italic;"><span style="font-style: italic;">    dns = "varunam,vayavyam,vaishnavam";</span><br style="font-style: italic;"><br>Now, the only command provided to change the acl is<br><span style="color: rgb(51, 51, 255);"><br>|set-acl --config=test</span><br>
<span style="font-style: italic;">Usage: set-acl --help|-?</span><br style="font-style: italic;">
<span style="font-style: italic;">  or   set-acl [--echo] [--no-prompt] [--verbose] [--vs=name] --config=name --aclfile=file</span><br style="font-style: italic;">
<span style="font-style: italic;">CLI014 aclfile is a required option.</span><br style="font-style: italic;">
<br><br>While quite powerful, is hardly friendly.<br><br>It would be nice to have an option to fetch the acl, do the required changes using a friendlier API, and update it back.<br>But before getting to an API, we need to parse the ACL syntax.<br><br><h2>Parsing the ACL</h2>We have multiple options when it comes to Parsing, Some are,<br><ul>
<li>Read in the complete as a text file, tokenize it and use rules to parse it.</li>
<li>Notice
that the language is simple and has only a few rules, so use regular
expressions to extract the relevant data in each line.<br>
</li>
<li>Massage the text a little bit so that it looks a little more like Tcl, and use Tcl to parse it.<br>
</li>
</ul>Now
all the above are equally valid, and you can do this in almost any
other language. Languages like c++ or java usually take the first two
approaches, <br>since they do not have the option of using the language parser to do their bidding.<br><br>But
dynamic laugnages like perl, ruby, python, scheme or factor allows you
to make use of the language machinery to get the work done.<br>It is a
more easier approach since the parsing is mainly done by the language,
and the only thing you have to do is to slightly change the data so
that it is <br>parsable.<br><br>Tcl being Tcl, It allows us one more entertaining option:<br><ul><li>Massage the Tcl so that it looks a bit more like the ACL syntax :)</li></ul>
<h3>ACL Syntax (from a Tcl point of view)</h3>In order to get the Tcl to parse ACL, we should be able to do this.<br><br><span style="color: rgb(51, 51, 255);">|set acls [get-acl --config=test]</span><br><span style="color: rgb(51, 51, 255);">|eval $acls</span><br><br>ie, the content of the variable $acls should be valid Tcl syntax.<br>Generally inorder to pull something like this off we would need to redefine the <span style="font-weight: bold;">unknown</span> procedure which<br>is called by tcl when it finds some thing it does not know about. But in this case, the syntax of the ACL does not<br>seem to be in need of any such gymnastics.<br><br>One of the interesting things that helps us here is that, the tcl is word oriented in that unless quoted by braces - {}<br>or
by doubble quotes -"" any other tokens are interpreted as valid
individual strings.. The quoted ones are interpreted as one single
string.<br>ie:<br><span style="font-weight: bold;">mycmd abc def ghi</span><br>is interpreted as the command mycmd having three strings as arguments ie "abc" "def" "ghi"<br><br>taking that a bit more,<br><span style="font-weight: bold;">mycmd (abc, def, ghi)<br></span>is interpreted as command mycmd taking 3 string arguments "<span style="font-weight: bold;">(abc</span>" "def"<span style="font-weight: bold;"> "ghi)"<br></span>notice how the brackets are interpreted as part of the string. this is very useful because we can define<br>mycmd as <br><span style="color: rgb(255, 0, 0);"><br>proc mycmd {<span style="font-weight: bold;">args</span>} {<br><span style="font-style: italic;">       #process args as a list</span><br>       process $args<br style="color: rgb(255, 0, 0);"></span><span style="color: rgb(255, 0, 0);">}</span><br style="color: rgb(255, 0, 0);"><span style="font-weight: bold;"><br></span>and inside the mycmd we can extract the original args from the list passed in.<br><br><span style="font-weight: bold;">Varargs</span><br>Notice the args paramenter, It is the way in which we can pass multiple arguments in tcl (like varargs in c/c++)<br>Tcl
collects all arguments to the procedure in a list and places it in the
'$args' variable if args is defined as the paramenter to the procedure.<br><span style="font-weight: bold;"><br>Quotes<br></span>As
you saw above, tcl does not really care about the string being
unquoted, this gives us considerable freedom to mould the calling
syntax as we wish.<br><br><span style="font-weight: bold;">Semicolons</span><br>Tcl uses ';' to specify command termination too.<br><br><span style="font-weight: bold;">Back to parsing</span><br>now,
it is not a very good idea to pollute the global namespace with all the
Acl specific procedures that we are going to write, so let us create a
namespace<br>of our own (open a file acl.tcl and copy the below in it,)<br><span style="color: rgb(255, 0, 0);">===========acl.tcl<br>namespace eval Acl {</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">}</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">===============</span><br style="color: rgb(255, 0, 0);">and our aim becomes<br><span style="color: rgb(51, 51, 255);">|source acl.tcl</span><br><span style="color: rgb(51, 51, 255);">|namespace eval Acl $acls</span><br><br>ie, the acls are valid tcl inside the namespace of Acl.<br><span style="color: rgb(51, 51, 255);">|namespace eval Acl $acls</span><br>invalid command name "version"<br><br>We can start implementing each commands that the namespace eval complains about.<br>just define dummy procedures. We are not bothered about parsing any thing at this point of time.<br><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">===========acl.tcl<br>
namespace eval Acl {<br>    proc version {ver} {}<br>    proc acl {name} {}<br>    proc authenticate {args}{}<br>    proc allow {args} {}<br>    proc deny {args} {}<br>    proc user {args} {}<br>    proc ip {args} {}<br>    proc dns {args} {}</span><br style="color: rgb(255, 0, 0);">
<span style="color: rgb(255, 0, 0);">}</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">===============</span><br>
<span style="color: rgb(51, 51, 255);">|namespace eval Acl $acls</span><br><br>Well, that did it, The Acl is now valid TCL, though it does not really does not do any thing.<br><br><h3>First Parsing Procedures</h3>
<span style="color: rgb(255, 0, 0);">namespace eval Acl {</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    variable ver {1.0}</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    variable acl </span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    variable curacl</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    array set Acl::acl {}</span><br style="color: rgb(255, 0, 0);"><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    proc version {ver} {</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">        set Acl::ver $ver</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    }</span><br style="color: rgb(255, 0, 0);"><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    proc acl {name} {</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">        set Acl::acl($name) ""</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">        set Acl::curacl $name</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    }<br>   #snipped the rest of procedures.<br style="color: rgb(255, 0, 0);"></span><span style="color: rgb(255, 0, 0);">}</span><br><br>As
you can see, I used variable to declare that it is a part of the
namespace. It is outside the scope of the procedures, and I can refer
to them as<br>$namespace::variable.<br><br><span style="font-weight: bold;">version<br></span>eg: <br>|version 3.0;<br><br><span style="color: rgb(255, 0, 0);">proc version {ver} {</span><br style="color: rgb(255, 0, 0);">
<span style="color: rgb(255, 0, 0);">    set Acl::ver $ver</span><br style="color: rgb(255, 0, 0);">
<span style="color: rgb(255, 0, 0);">}<br><br><br style="color: rgb(255, 0, 0);"></span>
As soon as the version entry in acl is evaluated, it invokes the 'version' command,<br>and we set the version inside the namespace scope. the semicolon is discarded by the tcl as it is a statement terminator.<br><br><span style="font-weight: bold;">acl<br></span>eg:<span style="font-weight: bold;"><br></span>|acl "mexico";<br><br><span style="font-weight: bold;"></span><span style="color: rgb(255, 0, 0);">proc acl {name} {</span><br style="color: rgb(255, 0, 0);">
<span style="color: rgb(255, 0, 0);">             set Acl::acl($name) [list "acl \\"$name\\";\\n"]</span><br style="color: rgb(255, 0, 0);">
<span style="color: rgb(255, 0, 0);">     set Acl::curacl $name</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">}<br><br>
</span>next comes the Acl entry. It has just one string after it, which
is interpreted as the argument, so we set the Acl being processed in
the curacl variable.<br>We have also set the Acl::acl array value here to be a one element list. We will be appending to it in the coming procedures.<br><br><span style="font-weight: bold;">authenticate</span><br>eg:<br><span style="color: rgb(0, 0, 0);">|authenticate (user,group) {</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);">    database = "default"</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);">    method = "basic"</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);">    prompt = "Hi There."</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);">}</span><br style="color: rgb(0, 0, 0);"><br><span style="color: rgb(255, 0, 0);">proc authenticate {args} {</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    set authargs [lindex $args 0]</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    set rest [lrange $args 1 end]</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    lappend Acl::acl($Acl::curacl) "authenticate $authargs $rest;\\n\\n"</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">}</span><br><br>
<br>As explained above, Tcl sees the statement (user,group) as one
single string "(user,group)" and the one that comes after it is with in<br>the braces - {} which means that it is again a \*single\* string for Tcl. <br>Had
it not been this case, we would have had to write procedures for
database, prompt and method, but as it is we are saved from that<br>effort.<br>lindex lets you extract a positional element from a list, and lrange does the same but returns a range.<br>lappend appens the given element to a list<br><br><span style="font-weight: bold;">allow</span><br>eg:<br>|allow (read,write)<br><span style="color: rgb(255, 0, 0);">proc allow {args} {</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    lappend Acl::acl($Acl::curacl) "allow $args\\n"</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">}</span><br style="color: rgb(255, 0, 0);"><br>While
the grammar of ACL does not put any restriction on the filter part of
the allow and deny statement, we can take advantage of the fact<br>that while returning through wadm, it always separates out the allow, user, ip and dns into neatly separated lines.<br><br><span style="font-weight: bold;">deny<br></span>eg:<br>
|deny (all)<br>
<span style="color: rgb(255, 0, 0);">proc deny {args} {</span><br style="color: rgb(255, 0, 0);">
<span style="color: rgb(255, 0, 0);">    lappend Acl::acl($Acl::curacl) "deny $args\\n"</span><br style="color: rgb(255, 0, 0);">
<span style="color: rgb(255, 0, 0);">}</span><br style="color: rgb(255, 0, 0);">
<br>we could have abstracted out the above two procedures into one, but the pay offs are not that huge in this case.<br><br><span style="font-weight: bold;">user,ip and dns</span><br>eg:<br>user = "rahul" and<br>ip = "129.158.223.\*,129.158.224.\*" or<br>dns = "machine1,machine2,machine3";<br><br><span style="color: rgb(255, 0, 0);">proc user {args} {</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    set cur [lindex $Acl::acl($Acl::curacl) end]</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    set Acl::acl($Acl::curacl) [lreplace $Acl::acl($Acl::curacl) end end "$cur user $args[ts $args]\\n"]</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">}</span><br style="color: rgb(255, 0, 0);"><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">proc ip {args} {</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    set cur [lindex $Acl::acl($Acl::curacl) end]</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    set Acl::acl($Acl::curacl) [lreplace $Acl::acl($Acl::curacl) end end "$cur ip $args[ts $args]\\n"]</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">}</span><br style="color: rgb(255, 0, 0);"><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">proc dns {args} {</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    set cur [lindex $Acl::acl($Acl::curacl) end]</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    set Acl::acl($Acl::curacl) [lreplace $Acl::acl($Acl::curacl) end end "$cur dns $args[ts $args]\\n"]</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">}</span><br style="color: rgb(255, 0, 0);"><br>We dont really care about what they have as the arguemnts any way.<br><br><h3>Sanity Check<br>
</h3>Now that we have implemented these, let us run the eval and see the results in the Acl::acl array.<br><span style="color: rgb(51, 51, 255);">|source acl.tcl</span><br><span style="color: rgb(51, 51, 255);">|namespace eval Acl $acls<br>|puts [array names Acl::acl]<br><span style="font-style: italic; color: rgb(0, 0, 0);">default mexico es-internal</span><br><br><span style="color: rgb(0, 0, 0);">Things seem to be working ok, Let us take one of them and see what it contains</span><br></span><span style="color: rgb(51, 51, 255);">|puts Acl::acl(mexico)<br><span style="color: rgb(0, 0, 0); font-style: italic;">{acl "mexico";<br>} {authenticate (user,group) {<br>        database = "default";<br>        method = "basic";<br>        prompt = "Hi there..";<br>};<br>} {deny (all)<br> user = anyone;<br>} {allow (read,write,execute,delete,list,info)<br> user = rahul and<br> ip = 129.158.223.\*,129.158.224.\* or<br> dns = machine1,machine2,machine3;<br>}<br><br></span><span style="color: rgb(0, 0, 0);">Well,
things seem nice enough. Now that we have parsed it, we need to access
it, change it, and get the result back as a nice clean ACL.<br>Here is a skeleton of such an API along with the complete script. You can modify it to have an interface that you like.<br><br>============================acl.tcl==================<br><font size="2"><span style="color: rgb(255, 0, 0);">namespace eval Acl {<br>    variable ver {1.0}<br>    variable acl<br>    variable config<br>    variable curacl<br>    variable text<br>    array set Acl::acl {}<br><br>    proc version {ver} {<br>        set Acl::ver $ver<br>    }<br><br>    proc reset {} {<br>        array set Acl::acl {}<br>        set Acl::curacl {}<br>    }<br><br>    proc init {config} {<br>        set acls [get-acl --config $config]<br>        set Acl::config $config<br>        eval $acls<br>    }<br><br>    #puts [array names Acl::acl]<br>    proc acl {name} {<br>        set Acl::acl($name) [list "acl \\"$name\\";\\n"]<br>        set Acl::curacl $name<br>    }<br>    #|namespace eval Acl $acls<br>    #invalid command name "authenticate"<br><br>    proc authenticate {args} {<br>        set authargs [lindex $args 0]<br>        set rest [lrange $args 1 end]<br>        lappend Acl::acl($Acl::curacl) "authenticate $authargs $rest;\\n\\n"<br>    }<br><br>    proc ts {arg} {<br>        if {![regexp {(and|or) \*$} $arg ]} {<br>            return ";\\n"<br>        } else {<br>            return ""<br>        }<br>    }<br>    <br>    proc allow {args} {<br>        lappend Acl::acl($Acl::curacl) "allow $args\\n"<br>    }<br>    <br>    proc deny {args} {<br>        lappend Acl::acl($Acl::curacl) "deny $args\\n"<br>    }<br><br>    proc user {args} {<br>        set cur [lindex $Acl::acl($Acl::curacl) end]<br>        set Acl::acl($Acl::curacl) [lreplace $Acl::acl($Acl::curacl) end end "$cur user $args[ts $args]\\n"]<br>    }<br>    <br>    proc ip {args} {<br>        set cur [lindex $Acl::acl($Acl::curacl) end]<br>        set Acl::acl($Acl::curacl) [lreplace $Acl::acl($Acl::curacl) end end "$cur ip $args[ts $args]\\n"]<br>    }<br>    <br>    proc dns {args} {<br>        set cur [lindex $Acl::acl($Acl::curacl) end]<br>        set Acl::acl($Acl::curacl) [lreplace $Acl::acl($Acl::curacl) end end "$cur dns $args[ts $args]\\n"]<br>    }<br><br>    proc show {acl} {<br>        set cur $Acl::acl($acl)<br>        set pos 0<br>        foreach cmd $cur {<br>            if {$pos} {<br>                puts "=========$pos============"<br>                puts $cmd<br>            }<br>            incr pos<br>        }<br>    }<br><br>    proc clone {old new} {<br>        set cur $Acl::acl($old)<br>        set new [lreplace $cur 0 0 "acl \\"$new\\";\\n"]<br>        set cur $Acl::acl($old)<br>    }<br><br>    proc get {acl} {<br>        set cur $Acl::acl($acl)<br>        #set text "version 3.0;\\n"<br>        set text ""<br>        foreach {cmd} $cur {<br>            set text "$text$cmd"<br>        }<br>        return $text<br>    }<br><br>    proc put {acl pos rule} {<br>        if {![regexp {; \*$} $rule]} {<br>            error "End rule with a ';'"<br>        }<br>        if {!$pos} {<br>            puts "Cant change the name."<br>            return<br>        }<br>        set cur $Acl::acl($acl)<br>        set new [lreplace $cur $pos $pos "$rule\\n"]<br>        set Acl::acl($acl) $new<br>    }<br><br>    proc add {acl rule} {<br>        if {![regexp {; \*$} $rule]} {<br>            error "End rule with a ';'"<br>        }<br>        set cur $Acl::acl($acl)<br>        set new [lappend cur "$rule\\n"]<br>        set Acl::acl($acl) $new<br>    }<br><br>    proc remove {acl pos} {<br>        set cur $Acl::acl($acl)<br>        set new [lreplace $cur $pos $pos]<br>        set Acl::acl($acl) $new<br>    }<br><br>    proc text {args} {<br>        set text "version 3.0;\\n\\n"<br>        if {[llength $args]} {<br>            set text "$text \\n[Acl::get $args]"<br>        } else {<br>            foreach {name} [array names Acl::acl] {<br>                set text "$text \\n[Acl::get $name]"<br>            }<br>        }<br>        return $text<br>    }<br>    proc save {args} {<br>        set txt "[text $args]"<br>        set fn "tmp.acl"<br>        set f [open $fn "w"]<br>        puts -nonewline $f $txt<br>        close $f<br>        set ret [set-acl --config $Acl::config --aclfile $fn ]<br>        file delete -force $fn<br>        return $ret<br>    }<br>}<br></span></font>=============================================<br></span></span><h3><span style="color: rgb(51, 51, 255);"><span style="color: rgb(0, 0, 0);">Using it:</span></span></h3>
<h3><span style="color: rgb(51, 51, 255);"><span style="color: rgb(0, 0, 0);"></span></span></h3>
<span style="color: rgb(51, 51, 255);"><span style="color: rgb(0, 0, 0);">#test is the name of config. The evaulation is done by the Acl::init internaly.<br><br><span style="color: rgb(51, 51, 255);">|Acl::init test</span><br style="color: rgb(51, 51, 255);"><span style="color: rgb(51, 51, 255);">|Acl::show mexico</span><br style="color: rgb(51, 51, 255);"><span style="font-style: italic;">=========1============</span><br style="font-style: italic;"><span style="font-style: italic;">authenticate (user,group) {</span><br style="font-style: italic;"><span style="font-style: italic;">        database = "default";</span><br style="font-style: italic;"><span style="font-style: italic;">        method = "basic";</span><br style="font-style: italic;"><span style="font-style: italic;">        prompt = "Hi there..";</span><br style="font-style: italic;"><span style="font-style: italic;">};</span><br style="font-style: italic;"><span style="font-style: italic;">=========2============</span><br style="font-style: italic;"><span style="font-style: italic;">deny (all)</span><br style="font-style: italic;"><span style="font-style: italic;"> user = anyone;</span><br style="font-style: italic;"><span style="font-style: italic;">=========3============</span><br style="font-style: italic;"><span style="font-style: italic;">allow (read,write,execute,delete,list,info)</span><br style="font-style: italic;"><span style="font-style: italic;"> user = rahul and</span><br style="font-style: italic;"><span style="font-style: italic;"> ip = 129.158.223.\*,129.158.224.\* or</span><br style="font-style: italic;"><span style="font-style: italic;"> dns = varunam,vayavyam,vaishnavam;</span><br style="font-style: italic;"><br style="font-style: italic;">The show prints out the numbers for use by later procedures.<br><br>Change the 3rd rule to allow (all) user = all;<br><span style="color: rgb(51, 51, 255);">|Acl::put mexico 3 {allow (all) user = all;}</span><br style="font-style: italic; color: rgb(51, 51, 255);"><span style="color: rgb(51, 51, 255);">|Acl::show mexico                           </span><br style="color: rgb(51, 51, 255);"><span style="font-style: italic;">=========1============</span><br style="font-style: italic;"><span style="font-style: italic;">authenticate (user,group) {</span><br style="font-style: italic;"><span style="font-style: italic;">        database = "default";</span><br style="font-style: italic;"><span style="font-style: italic;">        method = "basic";</span><br style="font-style: italic;"><span style="font-style: italic;">        prompt = "Hi there..";</span><br style="font-style: italic;"><span style="font-style: italic;">};</span><br style="font-style: italic;"><span style="font-style: italic;">=========2============</span><br style="font-style: italic;"><span style="font-style: italic;">deny (all)</span><br style="font-style: italic;"><span style="font-style: italic;"> user = anyone;</span><br style="font-style: italic;"><span style="font-style: italic;">=========3============</span><br style="font-style: italic;"><span style="font-style: italic;">allow (all) user = all;</span><br style="font-style: italic;"><br style="color: rgb(255, 0, 0); font-style: italic;"></span></span>
<br>Get the complete text<br><span style="color: rgb(51, 51, 255);">|Acl::text       </span><br><span style="font-style: italic;">version 3.0;</span><br style="font-style: italic;"><span style="font-style: italic;"> </span><br style="font-style: italic;"><span style="font-style: italic;">acl "mexico";</span><br style="font-style: italic;"><span style="font-style: italic;">authenticate (user,group) {</span><br style="font-style: italic;"><span style="font-style: italic;">        database = "default";</span><br style="font-style: italic;"><span style="font-style: italic;">        method = "basic";</span><br style="font-style: italic;"><span style="font-style: italic;">        prompt = "Hi there..";</span><br style="font-style: italic;"><span style="font-style: italic;">};</span><br style="font-style: italic;"><br style="font-style: italic;"><span style="font-style: italic;">deny (all)</span><br style="font-style: italic;"><span style="font-style: italic;"> user = anyone;</span><br style="font-style: italic;"><br style="font-style: italic;"><span style="font-style: italic;">allow (all) user = all;</span><br style="font-style: italic;"><span style="font-style: italic;"> </span><br style="font-style: italic;"><span style="font-style: italic;">acl "default";</span><br style="font-style: italic;"><span style="font-style: italic;">authenticate (user,group) {</span><br style="font-style: italic;"><span style="font-style: italic;">        prompt = "Sun Java System Web Server";</span><br style="font-style: italic;"><span style="font-style: italic;">};</span><br style="font-style: italic;"><br style="font-style: italic;"><span style="font-style: italic;">allow (read,execute,info)</span><br style="font-style: italic;"><span style="font-style: italic;"> user = anyone;</span><br style="font-style: italic;"><br style="font-style: italic;"><span style="font-style: italic;">allow (list,write,delete)</span><br style="font-style: italic;"><span style="font-style: italic;"> user = all;</span><br style="font-style: italic;"><span style="font-style: italic;"> </span><br style="font-style: italic;"><span style="font-style: italic;">acl "es-internal";</span><br style="font-style: italic;"><span style="font-style: italic;">allow (read,execute,info)</span><br style="font-style: italic;"><span style="font-style: italic;"> user = anyone;</span><br style="font-style: italic;"><br style="font-style: italic;"><span style="font-style: italic;">deny (list,write,delete)</span><br style="font-style: italic;"><span style="font-style: italic;"> user = anyone;</span><br style="font-style: italic;"><br style="font-style: italic;">
<br>You can also make it specific to one acl.<br><span style="color: rgb(51, 51, 255);">|Acl::text default</span><br><span style="font-style: italic;">version 3.0;</span><br style="font-style: italic;"><span style="font-style: italic;"> </span><br style="font-style: italic;"><span style="font-style: italic;">acl "default";</span><br style="font-style: italic;"><span style="font-style: italic;">authenticate (user,group) {</span><br style="font-style: italic;"><span style="font-style: italic;">        prompt = "Sun Java System Web Server";</span><br style="font-style: italic;"><span style="font-style: italic;">};</span><br style="font-style: italic;"><br style="font-style: italic;"><span style="font-style: italic;">allow (read,execute,info)</span><br style="font-style: italic;"><span style="font-style: italic;"> user = anyone;</span><br style="font-style: italic;"><br style="font-style: italic;"><span style="font-style: italic;">allow (list,write,delete)</span><br style="font-style: italic;"><span style="font-style: italic;"> user = all;</span><br style="font-style: italic;"><br style="font-style: italic;"><br>Now, we need to set this back into a file and use that file name as an argument for 'set-acl'. <br><span style="color: rgb(51, 51, 255);">|Acl::save default</span><br><span style="font-style: italic;">CLI201 Command 'set-acl' ran successfully<br><br></span>You can also do it with out the argument, in which case it will save the entire text in back to server.<span style="font-style: italic;"><br></span><span style="color: rgb(51, 51, 255);">|Acl::save</span><br><span style="font-style: italic;">CLI201 Command 'set-acl' ran successfully<br><br></span>The finished acl.tcl is available <a href="../../blue/resource/acl.tcl" target="_self">here</a>

        
    </div>

    <div class="entry-footer">
        <p class="entry-category">Category: wadm</p>
        <p class="entry-tags">Tags:  none </p>
        <p class="entry-links">
        <a href="https://blogs.oracle.com/blue/entry/acl_parse_thyself_scripting_with">Permanent link to this entry</a>
                        </p>
    </div>

	    
	</div>
{% endraw %}
