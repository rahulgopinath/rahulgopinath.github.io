---
layout: post
category : blog
tagline: "."
tags : [sunmicrosystems blog sun]
e: Scripting with servlets [rhino]  - part III  (SJS WebServer 7.0)
---
{% raw %}
<div class="entry" id="scripting_with_servlets_rhino_part">

	<h3 class="entry-title">
			Scripting with servlets [rhino]  - part III  (SJS WebServer 7.0)
	    </h3>

    <h4 class="entry-meta">By blue on <a href="#">Jan 16, 2007</a>
</h4>

    <div class="entry-body">
                                        	<p>
Writing Javascript servlets using <a title="rhino home page" href="http://www.mozilla.org/rhino/">Rhino </a>on Sun Java System WebServer 7.0. 
</p>
<h3>About the language<br>
</h3>
<p>Javascript is one of the few languages that are exceptionally neat in the specification. The syntax<br>is very simple and there are are very few exceptions to the rules. It provides a prototype based<br>inheritance model and supports all the higher order constructs like closures, objects, exceptions<br>etc.. </p>
<p>Since I had already discussed the complete sequence of instructions to get the servlets up and<br>running using other languages, I will stick to a somewhat brief outline here.<br></p>
<p>If you are using JDK6, then you already have access to scripting APIs in java, using which you<br>can load the language dynamically. It is simple to modify our parent ScriptServlet to do this (based<br>on a parameter passed in init, you can decide on the language loaded. I will treat that in a later entry.)<br></p>
<h3>RhinoServlet<br>
</h3>
<p>The ScriptServlet developed in the previous <a href="../../blue/entry/scripting_with_servlets_sun_java" target="_blank" title="Scripting servlets with Sun Java System WebServer 7.0">entry</a> is used here as the parent class. <br> <br></p>
<table width="675" height="88" cellspacing="1" cellpadding="1" border="1" align="center"><tbody><tr><td style="width: 100%;"><p><font size="2" color="#8e2020">package com.sun.servlet;<br><br>import javax.servlet.http.\*;<br>import org.mozilla.javascript.\*;<br>import org.mozilla.javascript.tools.shell.Global;<br><br>public class RhinoServlet extends ScriptServlet {<br>    public Context jm = Context.enter();<br>    protected final Global global = new Global();<br><br>    protected void finalize() throws Throwable {<br>        Context.exit();<br>    }<br><br>    public void initialize(String handler, Object code) throws Exception {<br>        global.init(jm);<br>        Function funct = jm.compileFunction(global, (String)code, handler, 1, null);<br>        funct.call(jm, global, funct, new Object[] {jm.javaToJS(this, global)});<br>    }<br><br>    public void eval(Object fn, HttpServletRequest request, HttpServletResponse response) {<br>        ((Function)fn).call(jm, global, (Function)fn, new Object[] {<br>            jm.javaToJS(request, global), <br>            jm.javaToJS(response, global)});<br>    }<br>}<br></font></p></td></tr></tbody></table>
<p> </p>
<h2>Providing the javascript handler<br>
</h2>
<h3>Jvm Bindings.</h3>
<p>The bindings are just like pure java, ie Use the 'dot' notation to access methods in objects.<br>(check out the nice <a title="jvm bindings comparison" href="http://blogs.sun.com/sundararajan/entry/java_integration_javascript_groovy_and">entry</a> by Sundararajan that compares the java bindings of various jvm languages<br>if you would like to know more.)<br></p>
<p><b>docroot/WEB-INF/code/rhino.js</b><br></p>
<table width="675" height="88" cellspacing="1" cellpadding="1" border="1" align="center"><tbody><tr><td style="width: 100%;"><p><font size="2" color="#8e2020">function (httpservlet) {<br>    do_get = function (request,response) {<br>        response.setContentType("text/html");<br>        this.out = response.getWriter();<br><br>        this.request = request;<br>        this.response = response;<br>        this.httpservlet = httpservlet;<br><br>        try {<br>            spath = request.getServletPath();<br>            filename = httpservlet.getServletConfig().getServletContext().getRealPath(spath);<br>            body = httpservlet.read(filename) + ""; // convert body to javascript string.<br>            this.out.println(eval(body));<br>        } catch (e) {<br>            this.out.println("&lt;html&gt;&lt;body&gt;&lt;b&gt;Servlet Error ("<br>                    + e.name + ")&lt;/b&gt;&lt;xmp&gt;" + e.message + "&lt;/xmp&gt;&lt;/body&gt;&lt;/html&gt;");<br>        }<br>    }<br>    httpservlet.add('get', do_get);<br>    httpservlet.add('post', do_get);<br>}<br></font></p></td></tr></tbody></table>
<br><p>As usual, we return a proc object with an arity 1 using which we get the current instance of  ScriptServlet. then we proceed<br>to set the 'get' and 'post' symbols<br></p>
<p>An example js script that can get executed:<br></p>
<p><b>/docroot/hello.js</b> <br></p>
<table width="675" height="88" cellspacing="1" cellpadding="1" border="1" align="center">
<tbody><tr><td style="width: 100%;"><p><font size="2" color="#8e2020">"&lt;html&gt; &lt;head&gt;&lt;title&gt;abc&lt;/title&gt;&lt;/head&gt; &lt;body&gt; &lt;h1&gt; Hello at "<br>    + new Date() + " from " + request.getServletPath() <br>    + " &lt;/h1&gt; &lt;/body&gt; &lt;/html&gt;"<br></font></p></td></tr></tbody>
</table>
<h3>Build  Steps. </h3>
<p>          The complete rhino-webapp is provided <a title="rhino-webapp" href="../../blue/resource/servlets/rhino-webapp.tar.gz">here</a>. You can download it and extract the contents to a<br>directory called 'rhino' inside your installation. It should be in the <b>samples/java/webapps/rhino</b> directory<br>in your installation of webserver as it refers to the common.xml for building.<br></p>
<p>Update the js.jar if required. </p>
<p>Your extracted directory will look like this.</p>
<p><font size="2" color="#473f42">|cd rhino<br>|find .<br>./docs<br>./docs/index.html<br>./src<br>./src/build.xml<br>./src/RhinoServlet.java<br>./src/docroot<br>./src/docroot/WEB-INF<br>./src/docroot/WEB-INF/lib<br>./src/docroot/WEB-INF/lib/js.jar<br>./src/docroot/WEB-INF/web.xml<br>./src/docroot/WEB-INF/sun-web.xml<br>./src/docroot/WEB-INF/code<br>./src/docroot/WEB-INF/code/rhino.js<br>./src/docroot/index.html<br>./src/docroot/hello.js<br>./src/ScriptServlet.java<br>./deploy.tcl</font> </p>
<p><br>You can run 'ant' from inside the src directory which will create the rhino-webapp.war in the<br>rhino directory. This war file can be deployed on the webserver using the wadm.<br></p>
<p><font size="2" face="courier new,courier,monospace" color="#0f11ff">wadm </font><font size="2" face="courier new,courier,monospace" color="#0f11ff"> -u admin</font><font size="2" face="courier new,courier,monospace" color="#0f11ff"> -f deploy.tcl</font><br></p>
<p> Once the deployment goes through, you will be able to access the js file using the url</p>
<font size="2" color="#0003ff">http://yourserver:port/rhino/hello.js</font><p>  <br></p>
        
    </div>

    <div class="entry-footer">
        <p class="entry-category">Category: scripting</p>
        <p class="entry-tags">Tags:  none </p>
        <p class="entry-links">
        <a href="https://blogs.oracle.com/blue/entry/scripting_with_servlets_rhino_part">Permanent link to this entry</a>
                        </p>
    </div>

	    
	</div>
{% endraw %}
